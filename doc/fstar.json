{
  "displayName": "F*",
  "name": "fstar",
  "mimeTypes": ["text/fstar"],
  "fileExtensions": ["fst","fsi"],
  
  "editorOptions": { "tabSize": 2, "insertSpaces": true },

  "lineComment":      "//",   
  "blockCommentStart": "(*",
  "blockCommentEnd":   "*)",

  "keywords": [
    "abstract", "and", "as", "assert", "asr", "assume", "base", "begin", "class", "default", "define", "delegate", 
    "do", "done", "downcast", "downto", "effect", "elif", "else", "end", "ensures", "exception", "exists", "extern", 
    "false", "finally", "for", "forall", "fun", "function", "if", "in", "inherit", "inline", "interface", "internal", 
    "land", "lazy", "let", "lor", "logic", "lsl", "lsr", "lxor", "match", "member", "method", "mod", "module", "namespace",
    "new", "null", "of", "open", "or", "override", "private", "prop", "public", "query", "rec", "reference", "requires", 
    "sig", "static", "struct", "then", "to", "true", "try", "type", "upcast", "use", "val", "virtual", "void", "when", 
    "while", "with", "monad_lattice", "terminating", "kind", "yield", "print", "atomic", "checked", "eager", "fixed", 
    "include", "mixin", "object", "parallel", "sealed", "volatile"
  ],

  "typeKeywords": [
    "forall", "exists", "requires", "ensures"      
  ],

  "typeStart": [
    "type","cotype","rectype","alias","struct","enum"
  ],

  "moduleKeywords": [
    "module","import","as","qualified"
  ],

  "kindConstants": [
    "E","P","H","V","X"
  ],

  "escapes" :  "\\\\(?:[nrt\\\\\"'\\?]|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|U[0-9a-fA-F]{6})",
  "symbols0": "[\\$%&\\*\\+@!\\/\\\\\\^~=\\.:\\-\\?]",
  "symbols" : "(?:@symbols0|[\\|<>])+",
  "idchars" : "[\\w']*", 

  "tokenizer": {
    "root": [
      ["((?:[a-z]@idchars\\/)+)([a-z]@idchars)", ["identifier.namespace","identifier"]],
      
      ["[a-z]@idchars(?!\\/)", 
        { "cases":{ "@keywords": { 
                    "cases": { "alias"  : { "token": "keyword", "next": "@alias_type" },
                             "struct" : { "token": "keyword", "next": "@struct_type" },
                             "type|cotype|rectype": { "token": "keyword", "next": "@type" }, 
                             "@default": "keyword" } 
                  },
                  "@default" : "identifier" }
        }
      ],
           
      ["[A-Z]@idchars", "identifier.constructor" ],

      ["_@idchars", "identifier.wildcard"],
      ["([a-z]@idchars\\/)+", "identifier.namespace" ],
      { "include": "@whitespace" },
      
      ["[{}()\\[\\]]", "@brackets"],
      ["[;,`]", "delimiter"],
      ["[<>](?![<>|]*@symbols0)", "@brackets" ],
      ["->(?!@symbols0|[>\\|])", "keyword" ],
      ["::?(?!@symbols0)", "type.operator", "@type"],
      ["::?(?=\\?)", "type.operator", "@type"],
      ["@\"", { "token": "string.quote", "bracket": "@open", "next": "@litstring" } ],
      ["@symbols", { "cases": { "\\-": "operator.minus",
                              "@keywords": "keyword.operator",
                              "@default": "operator" }}
      ],
      ["[0-9]+\\.[0-9]+([eE][\\-+]?[0-9]+)?", "number.float"],
      ["0[xX][0-9a-fA-F]+", "number.hex"],
      ["[0-9]+", "number"],
      ["\"([^\"\\\\]|\\\\.)*$", "string.invalid" ],  
      ["\"",  { "token": "string.quote", "bracket": "@open", "next": "@string" } ],
      ["'[^\\\\']'", "string"],
      ["(')(@escapes)(')", ["string","string.escape","string"]],
      ["'", "string.invalid"],
      ["^[ ]*#.*", "namespace"]
    ],

    "whitespace": [
      ["[ \\r\\n]+", "white"],
      ["\\(\\*", "comment", "@comment" ],
      ["//.*", "comment" ]
    ],

    "comment": [
      ["[^\\(\\*]+", "comment" ],
      ["\\(\\*",  "comment", "@push" ],
      ["\\*\\)",  "comment", "@pop"  ],
      ["[\\(\\*]", "comment"]
    ],  

    "string": [
      ["[^\\\\\"]+",  "string"],
      ["@escapes", "string.escape"],
      ["\\\\.",      "string.escape.invalid"],
      ["\"",        { "token": "string.quote", "bracket": "@close", "next": "@pop" } ]
    ],

    "litstring": [
      ["[^\"]+",    "string"],
      ["\"\"",       "string.escape"],
      ["\"",        { "token": "string.quote", "bracket": "@close", "next": "@pop" } ]
    ],
    "alias_type": [
      ["=", "keyword.operator"],                
      { "include": "@type" }
    ],

    "struct_type": [
      [ "\\((?!\\*|,*\\))", "@brackets", "@pop"],    
      { "include": "@type" }
    ],

    "type": [
      [ "\\((?!\\*)|[\\[\\{]", { "token": "@brackets.type" }, "@type_nested"],
      { "include": "@type_content" }
    ],

    "type_nested": [
      ["[)\\]\\}]", { "token": "@brackets.type" }, "@pop" ],
      ["[(\\[\\{]", { "token": "@brackets.type" }, "@push"],
      [",", "delimiter.type"],
      ["([a-z]@idchars)(\\s*)(:)(?!:)",["type.identifier.typeparam","white","type.operator"]],
      { "include": "@type_content" }
    ],

    "type_content": [
      { "include": "@whitespace" },
      ["[*!](?!@symbols)", "type.kind.identifier"],           
      ["'@idchars", "identifier.type.typevar" ],             
      ["[\\w]@idchars", 
        { "cases": { "@typeKeywords": "type.keyword",
                   "@keywords": { "token": "@rematch", "next": "@pop" },
                   "@default": "type.identifier"
        }}
      ],
      
      ["\\/\\\\|\\\\\\/|\\\\|::|->|=>|==>|==|<==>|>=|<=|[\\.:|]", "type.keyword.operator"],
      ["","","@pop"]  
    ]
  }
}